# Version Management

> ğŸ“ **æŸ¥çœ‹å˜æ›´æ—¥å¿—**: [English](./CHANGELOG.md) | [ç®€ä½“ä¸­æ–‡](./CHANGELOG.zh-CN.md)

## ä»£ç ä¿®æ”¹å»ºè®®

> [!IMPORTANT]
> åœ¨ä¿®æ”¹æ¶ˆæ¯å‘é€æˆ–å¤„ç†é€»è¾‘æ—¶ï¼Œå¿…é¡»æ³¨æ„ä»£ç ä¸­çš„**å¤šåˆ†æ”¯**æƒ…å†µã€‚ä¾‹å¦‚åœ¨ `opencode` æ’ä»¶ä¸­ï¼š
> - **æµå¼è¾“å‡º**ï¼šå­˜åœ¨ Native æ¨¡å¼ï¼ˆç¼–è¾‘æ¶ˆæ¯ï¼‰å’Œ Segment æ¨¡å¼ï¼ˆåˆ†æ®µå‘é€ï¼‰çš„åˆ†æ”¯ã€‚
> - **éæµå¼è¾“å‡º**ï¼šå­˜åœ¨æŒ‡ä»¤ç›´æ¥è¿”å›ã€è¶…æ—¶å…œåº•å‘é€ã€å·¥å…·è°ƒç”¨/Fallback è·¯å¾„ç­‰ã€‚
> ç±»ä¼¼çš„æ”¹åŠ¨å¿…é¡»åŒæ­¥åº”ç”¨åˆ°æ‰€æœ‰ç›¸å…³åˆ†æ”¯è·¯å¾„ï¼Œç¡®ä¿åŠŸèƒ½è¡Œä¸ºçš„ä¸€è‡´æ€§ã€‚

## Koishi Element èµ„æºå¤„ç†è§„èŒƒ

> [!IMPORTANT]
> åœ¨å¤„ç†æœ¬åœ°èµ„æºï¼ˆå›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ã€æ–‡ä»¶ï¼‰åˆ†å‘æ—¶ï¼Œå¿…é¡»éµå¾ªä»¥ä¸‹æ ‡å‡†ä»¥ç¡®ä¿è·¨å¹³å°å…¼å®¹æ€§ï¼š
>
> 1. **å­˜å‚¨è·¯å¾„**ï¼šèµ„æºåº”ç»Ÿä¸€å¤åˆ¶åˆ° `data/opencode/tmp/` ç›®å½•ã€‚
> 2. **URL æ ¼å¼**ï¼šä½¿ç”¨æ ‡å‡†çš„ `file:///` ç»å¯¹è·¯å¾„ï¼ˆRFC 8089ï¼‰ã€‚
>    - **æ¨èå†™æ³•**ï¼š`decodeURI(pathToFileURL(absPath).href)`ï¼Œç¡®ä¿è·¯å¾„ç¬¦åˆè§„èŒƒä¸”è§£ææ—¶æ˜¾ç¤ºåŸå§‹å­—ç¬¦ã€‚
> 3. **å¤šé€»è¾‘åˆ†æ”¯è¦†ç›–**ï¼šæ¶ˆæ¯å‘é€é€»è¾‘çš„ä¿®æ”¹å¿…é¡»åŒæ­¥è¦†ç›–ä»¥ä¸‹è·¯å¾„ï¼š
>    - **æµå¼è¾“å‡º**ï¼š`Native`ï¼ˆç¼–è¾‘æ¶ˆæ¯ï¼‰ä¸ `Segment`ï¼ˆåˆ†æ®µå‘é€ï¼‰åˆ†æ”¯ã€‚
>    - **éæµå¼è¾“å‡º**ï¼šAction ç›´æ¥è¿”å›ã€è¶…æ—¶å…œåº•å‘é€ã€å·¥å…·è°ƒç”¨åŠ Fallback è·¯å¾„ã€‚
> 4. **å¤§å¤šæ•°é€‚é…å™¨éƒ½ä¸æ”¯æŒå°†æ™®é€šæ¶ˆæ¯ç¼–è¾‘ä¸ºæ–‡ä»¶å‘é€æ¶ˆæ¯**ï¼šè¯·é¿å…è¿›è¡Œæ­¤ç±»ä¿®æ”¹ã€‚

## æ›´æ–°æ’ä»¶ç‰ˆæœ¬
> [!IMPORTANT]
> æ­¤å‘½ä»¤å¿…é¡»åœ¨ `koishi-app` æ ¹ç›®å½•è¿è¡Œï¼ˆå³å·¥ä½œåŒºæ ¹ç›®å½•ï¼‰ï¼Œè€Œä¸æ˜¯æ’ä»¶ç›®å½•ã€‚

åˆå§‹åˆ›å»ºçš„æ’ä»¶ç‰ˆæœ¬å·ä¸º 1.0.0ã€‚å½“ä½ ä¿®æ”¹è¿‡æ’ä»¶åï¼Œä½ éœ€è¦æ›´æ–°ç‰ˆæœ¬å·æ‰èƒ½é‡æ–°å‘å¸ƒã€‚åœ¨ **åº”ç”¨ç›®å½•** è¿è¡Œä¸‹é¢çš„å‘½ä»¤ä»¥æ›´æ–°ç‰ˆæœ¬å·ï¼š

```bash
npm run bump [...name] -- [-1|-2|-3|-p|-v <ver>] [-r]
```

- `name`: è¦æ›´æ–°çš„æ’ä»¶åˆ—è¡¨ï¼Œç¼ºçœæ—¶è¡¨ç¤ºå…¨éƒ¨ (æ­¤å¤„ name ä¸åŒ…å« koishi-plugin- å‰ç¼€ï¼Œè€Œæ˜¯ä½ çš„å·¥ä½œåŒºç›®å½•å)
- `-1, --major`: è·³åˆ°ä¸‹ä¸€ä¸ªå¤§ç‰ˆæœ¬ï¼Œä¾‹å¦‚ 3.1.4 -> 4.0.0
- `-2, --minor`: è·³åˆ°ä¸‹ä¸€ä¸ªä¸­ç‰ˆæœ¬ï¼Œä¾‹å¦‚ 3.1.4 -> 3.2.0
- `-3, --patch`: è·³åˆ°ä¸‹ä¸€ä¸ªå°ç‰ˆæœ¬ï¼Œä¾‹å¦‚ 3.1.4 -> 3.1.5
- `-p, --prerelease`: è·³åˆ°ä¸‹ä¸€ä¸ªé¢„è§ˆç‰ˆæœ¬ï¼Œå…·ä½“è¡Œä¸ºå¦‚ä¸‹
  - å¦‚æœå½“å‰ç‰ˆæœ¬æ˜¯ alpha.xï¼Œåˆ™è·³åˆ° beta.0
  - å¦‚æœå½“å‰ç‰ˆæœ¬æ˜¯ beta.xï¼Œåˆ™è·³åˆ° rc.0
  - å¦‚æœå½“å‰ç‰ˆæœ¬æ˜¯ rc.xï¼Œåˆ™ç§»é™¤ prerelease éƒ¨åˆ†
  - å…¶ä»–æƒ…å†µä¸‹ï¼Œè·³åˆ°ä¸‹ä¸€ä¸ªå¤§ç‰ˆæœ¬çš„ alpha.0
- `-v, --version`: è®¾ç½®å…·ä½“çš„ç‰ˆæœ¬å·
- `-r, --recursive`: é€’å½’æ›´æ–°ä¾èµ–ç‰ˆæœ¬
  - ç¼ºçœæƒ…å†µï¼šæŒ‰ç…§å½“å‰ç‰ˆæœ¬çš„æœ€åä¸€ä½é€’å¢

å½“è¿›è¡Œæ­¤æ“ä½œæ—¶ï¼Œå…¶ä»–ç›¸å…³æ’ä»¶çš„ä¾èµ–ç‰ˆæœ¬ä¹Ÿä¼šåŒæ­¥æ›´æ–°ï¼Œç¡®ä¿æ‰€æœ‰å·¥ä½œåŒºå†…ä¾èµ–çš„æ’ä»¶ç‰ˆæœ¬ä¸€è‡´ã€‚è¿›ä¸€æ­¥ï¼Œå¦‚æœä½ å¸Œæœ›æ›´æ–°äº†ä¾èµ–ç‰ˆæœ¬çš„æ’ä»¶ä¹ŸåŒæ—¶æ›´æ–°è‡ªèº«çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¯ä»¥é™„åŠ  `-r, --recursive` é€‰é¡¹ã€‚

## Publishing

After updating version, push to trigger automated release:

```bash
git push origin main
git push origin --tags
```

The `publish.yml` workflow will automatically:
1. Build the project
2. Publish to npm (using Trusted Publisher OIDC)
3. Generate provenance

## å·¥ä½œåŒºå¼€å‘è§„èŒƒ

> [!IMPORTANT]
> æœ¬èŠ‚ä¸­ä»‹ç»çš„å‘½ä»¤è¡Œéƒ½éœ€è¦åœ¨ `koishi-app` åº”ç”¨ç›®å½•ï¼ˆå³å·¥ä½œåŒºæ ¹ç›®å½•ï¼‰ä¸‹è¿è¡Œã€‚

### åˆå§‹åŒ–å·¥ä½œåŒº
å¦‚æœè¿˜æ²¡æœ‰ `koishi-app` ç›®å½•ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ–ï¼š

```bash
npm create koishi@latest koishi-app
```

åç»­æ‰€æœ‰æ“ä½œå‡åœ¨è¯¥ç›®å½•ä¸­è¿›è¡Œã€‚

### åˆ›å»ºæ–°æ’ä»¶
åœ¨åº”ç”¨ç›®å½•è¿è¡Œä¸‹é¢çš„å‘½ä»¤ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„æ’ä»¶å·¥ä½œåŒºï¼š

```bash
npm run setup [name] -- [-c] [-m] [-G]
```
- `name`: æ’ä»¶çš„åŒ…åï¼Œç¼ºçœæ—¶å°†è¿›è¡Œæé—®
- `-c, --console`: åˆ›å»ºä¸€ä¸ªå¸¦æ§åˆ¶å°æ‰©å±•çš„æ’ä»¶
- `-m, --monorepo`: åˆ›å»º monorepo çš„æ’ä»¶
- `-G, --no-git`: è·³è¿‡ git åˆå§‹åŒ–

### æ„å»ºæºä»£ç 
åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ä½¿ç”¨æˆ–å‘å¸ƒåˆ°æ’ä»¶å¸‚åœºå‰ï¼Œéœ€è¦æ„å»ºæºä»£ç ã€‚åœ¨åº”ç”¨ç›®å½•è¿è¡Œï¼š

```bash
npm run build [...name]
```
- `name`: è¦æ„å»ºçš„æ’ä»¶åˆ—è¡¨ï¼Œç¼ºçœæ—¶è¡¨ç¤ºå…¨éƒ¨æ’ä»¶

ä¾‹å¦‚ `example` æ’ä»¶ï¼š
- åç«¯ä»£ç è¾“å‡ºåˆ° `external/example/lib`
- å‰ç«¯ä»£ç è¾“å‡ºåˆ° `external/example/dist`

### æ·»åŠ ä¾èµ–
å¦‚æœéœ€è¦æ·»åŠ å…¶ä»–ä¾èµ–ï¼Œä½¿ç”¨ `-w` å‚æ•°æŒ‡å®šå·¥ä½œåŒºï¼š

```bash
npm install [...deps] -w koishi-plugin-[name]
```
- `name`: ä½ çš„æ’ä»¶åç§° (e.g. `opencode`)
- `deps`: è¦æ·»åŠ çš„ä¾èµ–åˆ—è¡¨
- æ·»åŠ  `devDependencies` æˆ– `peerDependencies` éœ€åŠ ä¸Š `-D` æˆ– `-P` å‚æ•°ã€‚

### æ›´æ–°ä¾èµ–ç‰ˆæœ¬
æ‰¹é‡æ›´æ–°æ‰€æœ‰å·¥ä½œåŒºçš„ä¾èµ–ç‰ˆæœ¬ï¼š

```bash
npm run dep
```
è¿™å°†æŒ‰ç…§æ¯ä¸ª `package.json` ä¸­å£°æ˜çš„ä¾èµ–ç‰ˆæœ¬è¿›è¡Œæ›´æ–°ï¼ˆä¾‹å¦‚ `^1.1.4` -> `^1.2.3`ï¼‰ã€‚

### äºŒæ¬¡å¼€å‘
ä¸å…¶ä»–æ’ä»¶ååŒå·¥ä½œæˆ–è°ƒè¯•æ—¶ï¼Œå¯ä»¥å°†å…¶ä»–ä»“åº“å…‹éš†åˆ° `external` ç›®å½•ï¼š

```bash
npm run clone [repo]
# ä¾‹å¦‚: npm run clone koishijs/koishi-plugin-forward
```

## Documentation

- [SDK Type Definitions](./docs/SDK_TYPES.md)

## Links

- [Koishi Plugin Registry](https://registry.koishi.chat/)
- [Koishi Development Guide](https://koishi.chat/zh-CN/guide/develop/workspace.html)
- [Koishi Element (Message Format)](https://koishi.chat/zh-CN/guide/basic/element.html)
- [npm Documentation](https://docs.npmjs.com/trusted-publishers)
